!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.toxicDecorators=e.toxicDecorators||{})}(this,function(e){"use strict";function r(e){return void 0===e||null===e}function t(e){return Array.isArray(e)}function n(e){return"function"==typeof e}function o(e){return!!e&&"object"===(void 0===e?"undefined":P(e))&&Object(e)===e&&"[object Object]"===String(e)&&!n(e)&&!t(e)}function i(e){return"number"==typeof e}function a(e){return"string"==typeof e}function u(e){return"boolean"==typeof e}function f(e){return!!e&&("object"===(void 0===e?"undefined":P(e))||"function"==typeof e)&&"function"==typeof e.then}function l(e){return r(e)||u(e)||a(e)||i(e)}function c(e){if(!e||!e.hasOwnProperty)return!1;for(var r=["value","initializer","get","set"],t=0,n=r.length;t<n;t++)if(e.hasOwnProperty(r[t]))return!0;return!1}function s(e){return!!e&&(n(e.get)||n(e.set))&&u(e.configurable)&&u(e.enumerable)&&void 0===e.writable}function p(e){return!!e&&n(e.initializer)&&u(e.configurable)&&u(e.enumerable)&&u(e.writable)}function h(e){return function(r){return Object.defineProperty(this,e,{configurable:!0,writable:!0,enumerable:!0,value:r}),r}}function d(e,r){return e.bind?e.bind(r):e.apply?function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.apply(r,n)}:function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.call.apply(e,[r].concat(S(n)))}}function y(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"You must pass me an array of function";if(!t(e)||e.length<1)throw new TypeError(r);if(1===e.length){if(!n(e[0]))throw new TypeError(r);return e[0]}return e.reduce(function(e,t){if(!n(t)||!n(e))throw new TypeError(r);return function(r){return d(t,this)(d(e,this)(r))}})}function v(){var e=console,r=e.warn,t=e.log;if(n(r))return r.apply(void 0,arguments);t.apply(void 0,arguments)}function b(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o.throwError,u=void 0!==i&&i,f=o.backup;if(a(n)&&(n=n.split(".")),!t(n))throw new TypeError("keys of getDeepProperty must be string or Array<string>");for(var l=[],c=e,s=0,p=n.length;s<p;s++){var h=n[s];if(r(c)){if(u)throw new Error("obj"+(l.length>0?"."+l.join("."):" itself")+" is "+c);return f}c=c[h],l.push(h)}return c}function g(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var o="compressMultipleDecorators only accept function";if(1===r.length){if(!n(r[0]))throw new TypeError(o);return r[0]}return function(e,t,i){return r.reduce(function(r,i){if(!n(i))throw new TypeError(o);return i(e,t,r)},i)}}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.get,o=e.set,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.preGet,u=void 0!==a&&a,f=i.preSet,l=void 0===f||f;if(!(n(r)||n(o)||t(r)&&r.length>0||t(o)&&o.length>0))throw new TypeError("@accessor need a getter or setter. If you don't need to add setter/getter. You should remove @accessor");var c="@accessor only accept function or array of function as getter/setter";return r=t(r)?y(r,c):r,o=t(o)?y(o,c):o,function(e,t,i){var a=i||{},f=a.configurable,c=void 0===f||f,h=a.enumerable,y=void 0===h||h,b=n(r),g=n(o),w=function(e){return b?d(r,this)(e):e},m=function(e){return g?d(o,this)(e):e};if(s(i)){var E=i.get,O=i.set,T=n(E),j=n(O);return!T&&b&&v("You are trying to set getter via @accessor on one property without getter. That's not a good idea."),!j&&g&&v("You are trying to set setter via @accessor on one property without setter. That's not a good idea."),{get:T||b?function(){var e=this,r=d(w,this),t=function(){return T?d(E,e)():void 0};return(u?[r,t]:[t,r]).reduce(function(e,r){return r(e)},void 0)}:void 0,set:j||g?function(e){var r=this,t=d(m,this),n=function(e){return j?d(O,r)(e):e};return(l?[t,n]:[n,t]).reduce(function(e,r){return r(e)},e)}:void 0,configurable:c,enumerable:y}}if(p(i)){var P=i.initializer,A=void 0,z=!1;return{get:function(){var e=d(w,this);return z?e(A):(A=d(P,this)(),z=!0,e(A))},set:function(e){var r=d(m,this);return A=l?r(e):e,z=!0,l||r(A),A},configurable:c,enumerable:y}}var k=(i||{}).value;return{get:function(){return d(w,this)(k)},set:function(e){var r=d(m,this);return k=l?r(e):e,l||r(k),k},configurable:c,enumerable:y}}}function m(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];if(0===r.length)throw new Error("@initialize accept at least one parameter. If you don't need to initialize your value, do not add @initialize.");if(r.length>2&&c(r[2]))throw new Error("You may use @initialize straightly, @initialize return decorators, you need to call it");var n=y(r,"@initialize only accept function parameter");return function(e,r,t){if(void 0===t)return{value:d(n,e)(),configurable:!0,writable:!0,enumerable:!0};if(s(t)){var o=!1;return w({get:function(e){return o?e:d(n,this)(e)},set:function(e){return o=!0,e}})(e,r,t)}if(p(t)){var i=t.initializer;return{initializer:function(){return d(n,this)(d(i,this)())},configurable:t.configurable,writable:t.writable,enumerable:t.enumerable}}return{value:d(n,this)(t.value),writable:t.writable,configurable:t.configurable,enumerable:t.enumerable}}}function E(e,r,t,n,o,i){var a=t.configurable,u=t.enumerable,f=i.force,l=i.omit,c=W(n,o);if(void 0!==c){if(l)return;if(!f)throw new Error("@alias can't set alias on an existing attribute");if(!c.configurable)throw new Error("You are tring to set alias on an existing attribute which its configurable is false. That's impossible. Please check if you have set @frozen on it.")}M(n,o,{get:function(){return e[r]},set:function(t){return e[r]=t,r},configurable:a,enumerable:u})}function O(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).exclude,o=void 0===e?[]:e;if(!t(o))throw new TypeError("options.exclude must be an array");return function(e){if(!n(e))throw new TypeError("@autobindClass can only be used on class");var t=e.prototype;if(r(t))throw new Error("The prototype of the class is empty, please check it");for(var i=V(t),a=x(t),u=0,f=a.length;u<f;u++){var l=a[u],c=i[l];"constructor"===l||!n(c.value)||o.indexOf(l)>-1||C(t,l,j(t,l,c))}}}function T(e,r){if("undefined"==typeof WeakMap)throw new Error("Using @autobind on "+r.name+"() requires WeakMap support due to its use of super."+r.name+"()");F||(F=new WeakMap),!1===F.has(e)&&F.set(e,new WeakMap);var t=F.get(e);return!1===t.has(r)&&t.set(r,d(r,e)),t.get(r)}function j(e,r,t){if(1===arguments.length)return O()(e);if(!c(t))throw new Error("@autobind must used on descriptor, are you using it on undefined property?");var o=t.value,i=t.configurable;if(!n(o))throw new TypeError("@autobind can only be used on functions, not: "+o+")");var a=e.constructor;return{configurable:i,enumerable:!1,get:function(){var t=this,n=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return o.call.apply(o,[t].concat(S(r)))};return this===e?o:this.constructor!==a&&Object.getPrototypeOf(this).constructor===a?o:this.constructor!==a&&r in this.constructor.prototype?T(this,o):(Object.defineProperty(this,r,{configurable:!0,writable:!0,enumerable:!1,value:n}),n)},set:h(r)}}var P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},z=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),k=function(){function e(e,r){var t=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),S=function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)},D=Object.getOwnPropertyNames,Y=Object.getOwnPropertySymbols,I=Object.getOwnPropertyDescriptor,x=("undefined"!=typeof window&&Object.prototype.toString.call(window),function(e){function r(n,i,a){if(t(n)||o(n)){i=i||(o(n)?{}:[]);for(var u in n)i[u]=r(n[u],i[u],u);return i}return e(n,i,a)}}(function(e){return e}),n(Y)?function(e){return D(e).concat(Y(e))}:D),V=n(Object.getOwnPropertyDescriptors)?Object.getOwnPropertyDescriptors:function(e){return x(e).reduce(function(r,t){return r[t]=I(e,t),r},{})},W=Object.getOwnPropertyDescriptor,M=Object.defineProperty,C=Object.defineProperty,F=void 0,N=Object.defineProperty,B=Object.getOwnPropertyDescriptor,U=Object.defineProperty,_=Object.defineProperty,q=Object.defineProperty,G=Object.getOwnPropertyDescriptor,K=Object.defineProperty,H=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.prop,n=r.handler,o=r.deep;A(this,e),this.oldVal=void 0,this.newVal=void 0,this.inited=!1,this.prop=t,this.handler=n,this.deep=o}return z(e,[{key:"pre",value:function(e,r){return this.oldVal=r[this.prop],e}},{key:"post",value:function(e,r){var t=this.oldVal,n=this.handler,i=this.deep,a=this.prop;if(t===e)return e;var u=this.newVal=r[a];if(d(n,r)(u,t),i&&o(t))for(var f=x(u),l=0,c=f.length;l<c;l++){var s=f[l];this.deepObeserve(u,s,r)}return this.inited=!0,this.oldVal=u,e}},{key:"getter",value:function(e,r){var t=this.inited,n=this.oldVal,i=this.deep;if(!t&&n!==e&&(this.inited=!0,this.oldVal=e,i&&o(e)))for(var a=x(e),u=0,f=a.length;u<f;u++){var l=a[u];this.deepObeserve(e,l,r)}return e}},{key:"deepObeserve",value:function(r,t,n){var o=this.handler,i=this.deep,a=G(r,t);if(!1!==a.writable){var u=new e({prop:t,handler:o,deep:i});K(r,t,g(w({set:function(e){return u.pre(e,n)},get:function(e){return u.getter(e,n)}},{preSet:!0}),w({set:function(e){return u.post(e,n)}},{preSet:!1}))(r,t,a))}}}]),e}(),J=Object.defineProperty,L=Object.getOwnPropertyDescriptor;e.accessor=w,e.before=function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];if(0===r.length)throw new Error("@before accept at least one parameter. If you don't need to preprocess before your function, do not add @before decorators");if(r.length>2&&c(r[2]))throw new Error("You may use @before straightly, @before return decorators, you need to call it");for(var i=r.length-1;i>-1;i--)if(!n(r[i]))throw new TypeError("@before only accept function parameter");return function(e,o,i){if(void 0===i)throw new Error("@before must used on descriptor, are you using it on undefined property?");var a=i.value,u=i.configurable,f=i.enumerable,l=i.writable;if(!n(a))throw new TypeError("@before can only be used on function");return{value:function(){for(var e=this,n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];var u=r.reduce(function(r,n){var o=d(n,e).apply(void 0,S(r));return void 0===o?r:t(o)?o:[o]},o);return d(a,this).apply(void 0,S(u))},configurable:u,enumerable:f,writable:l}}},e.after=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];if(0===r.length)throw new Error("@after accept at least one parameter. If you don't need to preprocess after your function, do not add @after decorators");if(r.length>2&&c(r[2]))throw new Error("You may use @after straightly, @after return decorators, you need to call it");var o=y(r,"@after only accept function parameter");return function(e,r,t){if(void 0===t)throw new Error("@after must used on descriptor, are you using it on undefined property?");var i=t.value,a=t.configurable,u=t.enumerable,f=t.writable;if(!n(i))throw new TypeError("@after can only be used on function");return{value:function(){var e=d(i,this).apply(void 0,arguments);return d(o,this)(e)},configurable:a,enumerable:u,writable:f}}},e.readonly=function(e,r,t){return void 0===t?(v("You are using @readonly on an undefined property. This property will become a readonly undefined forever, which is meaningless"),{value:void 0,writable:!1,enumerable:!0,configurable:!0}):s(t)?(t.set=void 0,t):(t.writable=!1,t)},e.alias=function(e,r,t){if(2===arguments.length?a(e)&&(t=r,r=e,e=void 0):1===arguments.length&&(r=e,e=void 0),!a(r))throw new TypeError("@alias need a string as a key to find the porperty to set alias on");var n="If you want to use @alias to set alias on other instance, you must pass in a legal instance";if(void 0!==e&&l(e))throw new TypeError(n);var i=o(t)?t:{force:!1,omit:!1},u=i.force,f=i.omit;return function(t,o,i){function a(e,r,t){var o=l(e)?r:e,i=t.split("."),a=i.slice(-1),u=k(a,1)[0];if(o=b(o,i.slice(0,-1),{throwError:!0}),l(o))throw new TypeError(n);return{target:o,name:u}}if(i=i||{value:void 0,configurable:!0,writable:!0,enumerable:!0},p(i))return m(function(t){var n=a(e,this,r),l=n.target,c=n.name;return E(this,o,i,l,c,{force:u,omit:f}),t})(t,o,i);if(s(i)){var c=void 0,h=function(t){if(c)return t;var n=a(e,this,r),l=n.target,s=n.name;return E(this,o,i,l,s,{force:u,omit:f}),c=!0,t};return w({get:h,set:h})(t,o,i)}var d=a(e,t,r),y=d.target,v=d.name;return E(t,o,i,y,v,{force:u,omit:f}),i}},e.autobind=j,e.frozen=function(e,r,t){if(void 0===t)return v("You are using @frozen on an undefined property. This property will become a frozen undefined forever, which is meaningless"),{value:void 0,writable:!1,enumerable:!1,configurable:!1};if(t.enumerable=!1,t.configurable=!1,s(t)){var o=t.get;return t.set=void 0,n(o)?{get:function(){var e=d(o,this)();return N(this,r,{value:e,writable:!1,configurable:!1,enumerable:!1}),e},set:void 0,configurable:!1,enumerable:!1}:void v("You are using @frozen on one accessor descriptor without getter. This property will become a frozen undefined finally.Which maybe meaningless.")}return t.writable=!1,t},e.initialize=m,e.waituntil=function(e,t){if(!n(e)&&!f(e)&&!a(e))throw new TypeError("@waitUntil only accept Function, Promise or String");return function(o,i,a){if(void 0===a)throw new Error("@waituntil must used on descriptor, are you using it on undefined property?");var u=a.value,s=a.configurable;if(!n(u))throw new TypeError("@waituntil can only be used on function, but not "+u);var p=!1,h=[],y=f(e)?function(){return e}:n(e)?e:function(){var n=e.split("."),o=n.slice(-1),i=l(t)?this:t;if(!p){var a=b(i,n.slice(0,-1));if(r(a))return a;var u=B(a,o),f=function(e){if(!0===e)for(;h.length>0;)h[0](),h.shift();return e},s=c(u)?w({set:f})(a,o,u):w({set:f})(a,o,{value:void 0,configurable:!0,enumerable:!0,writable:!0});U(a,o,s),p=!0}return b(i,n)};return{value:function(){for(var e=this,r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];var o=d(u,this),i=d(y,this).apply(void 0,t);return f(i)?Promise.resolve(i).then(function(){return d(u,e).apply(void 0,t)}):!0===i?d(u,this).apply(void 0,t):new Promise(function(e){h.push(function(){o.apply(void 0,t),e()})})},enumerable:!1,configurable:s,writable:!1}}},e.lazyInit=function(e,r,t){if(void 0===t)throw new TypeError("@lazyInit cannot be apply on undefined property.");if(!n(t.initializer))return v("@lazyInit can only be used on property, but not methods and getter/setter."),t;var o=t.initializer,i=t.configurable,a=t.enumerable,u=t.writable;return{get:function(){var e=d(o,this)();return _(this,r,{value:e,configurable:i,enumerable:a,writable:u}),e},set:h(r),configurable:i,enumerable:a}},e.lock=function(e,r,t){if(void 0===t)return v("You are using @lock on an undefined property. This property will become a lock undefined forever, which is meaningless"),{value:void 0,writable:!1,enumerable:!0,configurable:!1};if(t.configurable=!1,s(t)){var o=t.get;return t.set=void 0,n(o)?{get:function(){var e=d(o,this)();return q(this,r,{value:e,writable:!1,configurable:!1,enumerable:t.enumerable}),e},set:void 0,configurable:!1,enumerable:t.enumerable}:void v("You are using @lock on one accessor descriptor without getter. This property will become a lock undefined finally.Which maybe meaningless.")}return t.writable=!1,t},e.watch=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.deep,o=r.other,i=r.omit;if(!a(e)&&!n(e))throw new TypeError("You must pass a function or a string to find the hanlder function.");if(void 0!==o&&l(o))throw new TypeError("If you want us to trigger function on the other instance, you must pass in a legal instance");return function(r,u,f){var c=a(e)?function(t,a){var u=b(l(o)?r:o,e);if(!n(u)){if(!i)throw new Error("You pass in a function for us to trigger, please ensure the property to be a function or set omit flag true");return function(){}}return u}:e,s=new H({prop:u,handler:c,deep:t});return g(w({set:function(e){return s.pre(e,this)},get:function(e){return s.getter(e,this)}},{preSet:!0}),w({set:function(e){return console.log("you call this",e),s.post(e,this)}},{preSet:!1}))(r,u,f)}},e.enumerable=function(e,r,t){return void 0===t?{value:void 0,enumerable:!0,configurable:!0,writable:!0}:(t.enumerable=!0,t)},e.nonenumerable=function(e,r,t){return void 0===t?{value:void 0,enumerable:!1,configurable:!0,writable:!0}:(t.enumerable=!1,t)},e.nonconfigurable=function(e,r,t){return void 0===t?{value:void 0,enumerable:!0,configurable:!1,writable:!0}:(t.configurable=!1,t)},e.initString=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=a(r[0])?r.shift():"";return r.unshift(function(e){return a(e)?e:n}),m.apply(void 0,r)},e.initBoolean=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=!!u(r[0])&&r.shift();return r.unshift(function(e){return u(e)?e:n}),m.apply(void 0,r)},e.initArray=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=t(r[0])?r.shift():[];return r.unshift(function(e){return t(e)?e:o}),m.apply(void 0,r)},e.initNumber=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=i(r[0])?r.shift():0;return r.unshift(function(e){return i(e)?e:n}),m.apply(void 0,r)},e.alwaysString=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=a(r[0])?r.shift():"";return r.unshift(function(e){return a(e)?e:n}),w({set:r,get:r})},e.alwaysBoolean=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=!!u(r[0])&&r.shift();return r.unshift(function(e){return u(e)?e:n}),w({set:r,get:r})},e.alwaysArray=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=t(r[0])?r.shift():[];return r.unshift(function(e){return t(e)?e:o}),w({set:r,get:r})},e.alwaysNumber=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=i(r[0])?r.shift():0;return r.unshift(function(e){return i(e)?e:n}),w({set:r,get:r})},e.autobindClass=O,e.applyDecorators=function(e,i){var a=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).self,u=void 0!==a&&a,f=n(i);if(f||t(i)){if(!n(e))throw new TypeError("If you want to decorator class, you must pass it a legal class");if(f)i(e);else for(var c=0,s=i.length;c<s;c++){var p=i[c];if(!n(p))throw new TypeError("If you want to decorate an class, you must pass it function or array of function");p(e)}return e}if(!u&&!n(e))throw new TypeError("applyDecorators only accept class as first arguments. If you want to modify instance, you should set options.self true.");if(u&&l(e))throw new TypeError("We can't apply docorators on a primitive value, even in self mode");if(!o(i))throw new TypeError("applyDecorators only accept object as second arguments");var h=u?e:e.prototype;if(r(h))throw new Error("The class muse have a prototype, please take a check");for(var d in i){var y=i[d],b=t(y)?y:[y],w=void 0;try{w=g.apply(void 0,S(b))}catch(e){throw v(e&&e.message),new Error("The decorators set on props must be Function or Array of Function")}var m=L(h,d);J(h,d,w(h,d,m))}return e},e.getOwnKeys=x,e.getOwnPropertyDescriptors=V,Object.defineProperty(e,"__esModule",{value:!0})});
