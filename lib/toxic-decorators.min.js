!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.toxicDecorators=e.toxicDecorators||{})}(this,function(e){"use strict";function r(e){return void 0===e||null===e}function n(e){return Array.isArray(e)}function t(e){return"function"==typeof e}function o(e){return!!e&&"object"===(void 0===e?"undefined":A(e))&&Object(e)===e&&"[object Object]"===String(e)&&!t(e)&&!n(e)}function i(e){return"number"==typeof e}function u(e){return"string"==typeof e}function a(e){return"boolean"==typeof e}function f(e){return!!e&&("object"===(void 0===e?"undefined":A(e))||"function"==typeof e)&&"function"==typeof e.then}function l(e){return r(e)||a(e)||u(e)||i(e)}function c(e){if(!e||!e.hasOwnProperty)return!1;for(var r=["value","initializer","get","set"],n=0,t=r.length;n<t;n++)if(e.hasOwnProperty(r[n]))return!0;return!1}function s(e){return!!e&&(t(e.get)||t(e.set))&&a(e.configurable)&&a(e.enumerable)&&void 0===e.writable}function p(e){return!!e&&t(e.initializer)&&a(e.configurable)&&a(e.enumerable)&&a(e.writable)}function y(e){return function(r){return Object.defineProperty(this,e,{configurable:!0,writable:!0,enumerable:!0,value:r}),r}}function b(e,r){return e.bind?e.bind(r):e.apply?function(){for(var n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];return e.apply(r,t)}:function(){for(var n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];return e.call.apply(e,[r].concat(j(t)))}}function d(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"You must pass me an array of function";if(!n(e)||e.length<1)throw new TypeError(r);if(1===e.length){if(!t(e[0]))throw new TypeError(r);return e[0]}return e.reduce(function(e,n){if(!t(n)||!t(e))throw new TypeError(r);return function(r){return b(n,this)(b(e,this)(r))}})}function h(){var e=console,r=e.warn,n=e.log;if(t(r))return r.apply(void 0,arguments);n.apply(void 0,arguments)}function v(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o.throwError,a=void 0!==i&&i,f=o.backup;if(u(t)&&(t=t.split(".")),!n(t))throw new TypeError("keys of getDeepProperty must be string or Array<string>");for(var l=[],c=e,s=0,p=t.length;s<p;s++){var y=t[s];if(r(c)){if(a)throw new Error("obj"+(l.length>0?"."+l.join("."):" itself")+" is "+c);return f}c=c[y],l.push(y)}return c}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.get,o=e.set;if(!(t(r)||t(o)||n(r)&&r.length>0||n(o)&&o.length>0))throw new TypeError("@accessor need a getter or setter. If you don't need to add setter/getter. You should remove @accessor");var i="@accessor only accept function or array of function as getter/setter";return r=n(r)?d(r,i):r,o=n(o)?d(o,i):o,function(e,n,i){if(void 0===i)return{get:r,set:o,configurable:!0,enumerable:!0};var u=i.configurable,a=i.enumerable,f=t(r),l=t(o),c=function(e){return f?b(r,this)(e):e},y=function(e){return l?b(o,this)(e):e};if(s(i)){var d=i.get,v=i.set,g=t(d),w=t(v);return!g&&f&&h("You are trying to set getter via @accessor on one property without getter. That's not a good idea."),!w&&l&&h("You are trying to set setter via @accessor on one property without setter. That's not a good idea."),{get:g||f?function(){var e=g?b(d,this)():void 0;return b(c,this)(e)}:void 0,set:w||l?function(e){var r=b(y,this)(e);return w?b(v,this)(r):r}:void 0,configurable:u,enumerable:a}}if(p(i)){var m=i.initializer,E=void 0,A=!1;return{get:function(){var e=b(c,this);return A?e(E):(E=b(m,this)(),A=!0,e(E))},set:function(e){return E=b(y,this)(e)},configurable:u,enumerable:a}}var j=i.value;return{get:function(){return b(c,this)(j)},set:function(e){return j=b(y,o)(e)},configurable:u,enumerable:a}}}function w(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];if(0===r.length)throw new Error("@initialize accept at least one parameter. If you don't need to initialize your value, do not add @initialize.");if(r.length>2&&c(r[2]))throw new Error("You may use @initialize straightly, @initialize return decorators, you need to call it");var t=d(r,"@initialize only accept function parameter");return function(e,r,n){if(void 0===n)return{value:b(t,e)(),configurable:!0,writable:!0,enumerable:!0};if(s(n)){var o=!1;return g({get:function(e){return o?e:b(t,this)(e)},set:function(e){return o=!0,e}})(e,r,n)}if(p(n)){var i=n.initializer;return{initializer:function(){return b(t,this)(b(i,this)())},configurable:n.configurable,writable:n.writable,enumerable:n.enumerable}}return{value:b(t,this)(n.value),writable:n.writable,configurable:n.configurable,enumerable:n.enumerable}}}function m(e,r,n,t,o){if(void 0!==O(t,o))throw new Error("@alias can't set alias on an existing attribute");T(t,o,{get:function(){return e[r]},set:function(n){return e[r]=n,r},configurable:n.configurable,enumerable:n.enumerable})}function E(e,r){if("undefined"==typeof WeakMap)throw new Error("Using @autobind on "+r.name+"() requires WeakMap support due to its use of super."+r.name+"()");P||(P=new WeakMap),!1===P.has(e)&&P.set(e,new WeakMap);var n=P.get(e);return!1===n.has(r)&&n.set(r,b(r,e)),n.get(r)}var A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j=function(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)},O=("undefined"!=typeof window&&Object.prototype.toString.call(window),function(e){function r(t,i,u){if(n(t)||o(t)){i=i||(o(t)?{}:[]);for(var a in t)i[a]=r(t[a],i[a],a);return i}return e(t,i,u)}}(function(e){return e}),Object.getOwnPropertyDescriptor),T=Object.defineProperty,P=void 0,z=Object.defineProperty,S=Object.getOwnPropertyDescriptor,k=Object.defineProperty,D=Object.defineProperty,Y=Object.getOwnPropertyDescriptor;e.accessor=g,e.before=function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];if(0===r.length)throw new Error("@before accept at least one parameter. If you don't need to preprocess before your function, do not add @before decorators");if(r.length>2&&c(r[2]))throw new Error("You may use @before straightly, @before return decorators, you need to call it");for(var i=r.length-1;i>-1;i--)if(!t(r[i]))throw new TypeError("@before only accept function parameter");return function(e,o,i){if(void 0===i)throw new Error("@before must used on descriptor, are you using it on undefined property?");var u=i.value,a=i.configurable,f=i.enumerable,l=i.writable;if(!t(u))throw new TypeError("@before can only be used on function");return{value:function(){for(var e=this,t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];var a=r.reduce(function(r,t){var o=b(t,e).apply(void 0,j(r));return void 0===o?r:n(o)?o:[o]},o);return b(u,this).apply(void 0,j(a))},configurable:a,enumerable:f,writable:l}}},e.readonly=function(e,r,n){return void 0===n?(h("You are using @readonly on an undefined property. This property will become a readonly undefined forever, which is meaningless"),{value:void 0,writable:!1,enumerable:!0,configurable:!0}):s(n)?(n.set=void 0,n):(n.writable=!1,n)},e.alias=function(e,r){if(!u(e))throw new TypeError("@alias need a string as a key to find the porperty to set alias on");return function(n,o,i){i=i||{value:void 0,configurable:!0,writable:!0,enumerable:!0};var u=r&&t(r.hasOwnProperty);if(p(i))return w(function(n){return m(this,o,i,u?r:this,e),n})(n,o,i);if(s(i)){var a=void 0,f=function(n){return a?n:(m(this,o,i,u?r:this,e),a=!0,n)};return g({get:f,set:f})(n,o,i)}return m(n,o,i,u?r:n,e),i}},e.autobind=function(e,r,n){if(!c(n))throw new Error("@autobind must used on descriptor, are you using it on undefined property?");var o=n.value,i=n.configurable;if(!t(o))throw new TypeError("@autobind can only be used on functions, not: "+o+")");var u=e.constructor;return{configurable:i,enumerable:!1,get:function(){var n=this,t=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return o.call.apply(o,[n].concat(j(r)))};return this===e?o:this.constructor!==u&&Object.getPrototypeOf(this).constructor===u?o:this.constructor!==u&&r in this.constructor.prototype?E(this,o):(Object.defineProperty(this,r,{configurable:!0,writable:!0,enumerable:!1,value:t}),t)},set:y(r)}},e.frozen=function(e,r,n){if(void 0===n)return h("You are using @frozen on an undefined property. This property will become a frozen undefined forever, which is meaningless"),{value:void 0,writable:!1,enumerable:!1,configurable:!1};if(n.enumerable=!1,n.configurable=!1,s(n)){var o=n.get;return n.set=void 0,t(o)?{get:function(){var e=b(o,this)();return z(this,r,{value:e,writable:!1,configurable:!1,enumerable:!1}),e},set:void 0,configurable:n.configurable,enumerable:n.enumerable}:void h("You are using @frozen on one accessor descriptor without getter. This property will become a frozen undefined finally.Which maybe meaningless.")}return n.writable=!1,n},e.initialize=w,e.waituntil=function(e,n){if(!t(e)&&!f(e)&&!u(e))throw new TypeError("@waitUntil only accept Function, Promise or String");return function(o,i,u){if(void 0===u)throw new Error("@waituntil must used on descriptor, are you using it on undefined property?");var a=u.value,s=u.configurable;if(!t(a))throw new TypeError("@waituntil can only be used on function, but not "+a);var p=!1,y=[],d=f(e)?function(){return e}:t(e)?e:function(){var t=e.split("."),o=t.slice(-1),i=l(n)?this:n;if(!p){var u=v(i,t.slice(0,-1));if(r(u))return u;var a=S(u,o),f=function(e){if(!0===e)for(;y.length>0;)y[0](),y.shift();return e},s=c(a)?g({set:f})(u,o,a):g({set:f})(u,o,{value:void 0,configurable:!0,enumerable:!0,writable:!0});k(u,o,s),p=!0}return v(i,t)};return{value:function(){for(var e=this,r=arguments.length,n=Array(r),t=0;t<r;t++)n[t]=arguments[t];var o=b(a,this),i=b(d,this).apply(void 0,n);return f(i)?Promise.resolve(i).then(function(){return b(a,e).apply(void 0,n)}):!0===i?b(a,this).apply(void 0,n):new Promise(function(e){y.push(function(){o.apply(void 0,n),e()})})},enumerable:!1,configurable:s,writable:!1}}},e.enumerable=function(e,r,n){return void 0===n?{value:void 0,enumerable:!0,configurable:!0,writable:!0}:(n.enumerable=!0,n)},e.nonenumerable=function(e,r,n){return void 0===n?{value:void 0,enumerable:!1,configurable:!0,writable:!0}:(n.enumerable=!1,n)},e.nonconfigurable=function(e,r,n){return void 0===n?{value:void 0,enumerable:!0,configurable:!1,writable:!0}:(n.configurable=!1,n)},e.initString=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.unshift(function(e){return u(e)?e:""}),w.apply(void 0,r)},e.initBoolean=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.unshift(function(e){return!!a(e)&&e}),w.apply(void 0,r)},e.initArray=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.unshift(function(e){return n(e)?e:[]}),w.apply(void 0,r)},e.initNumber=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.unshift(function(e){return i(e)?e:0}),w.apply(void 0,r)},e.alwaysString=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.unshift(function(e){return u(e)?e:""}),g({set:r,get:r})},e.alwaysBoolean=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.unshift(function(e){return!!a(e)&&e}),g({set:r,get:r})},e.alwaysArray=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.unshift(function(e){return n(e)?e:[]}),g({set:r,get:r})},e.alwaysNumber=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.unshift(function(e){return i(e)?e:0}),g({set:r,get:r})},e.applyDecorators=function(e,i){var u=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).self,a=void 0!==u&&u;if(!a&&!t(e))throw new TypeError("applyDecorators only accept class as first arguments. If you want to modify instance, you should set options.self true.");if(a&&l(e))throw new TypeError("We can't apply docorators on a primitive value, even in self mode");if(!o(i))throw new TypeError("applyDecorators only accept object as second arguments");var f=a?e:e.prototype;if(r(f))throw new Error("The class muse have a prototype, please take a check");for(var c in i)for(var s=i[c],p=n(s)?s:[s],y=0,b=p.length;y<b;y++){var d=p[y];if(!t(d))throw new Error("The decorators set on props must be Function or Array of Function");var h=Y(f,c);D(f,c,d(f,c,h))}return e},Object.defineProperty(e,"__esModule",{value:!0})});
